<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Jobs - Cleaning Service</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Job Openings</h1>
    <nav>
      <a href="index.html">About</a>
      <a href="jobs.html">Jobs</a>
    </nav>
  </header>

  <section id="jobs"></section>

  <!-- Modal -->
  <div id="applyModal" class="modal">
    <div class="modal-content">
      <span id="closeModal">&times;</span>
      <h2>Apply for Job</h2>
      <form id="applyForm">
        <input type="hidden" name="Job_ID" id="jobId">
        <label>Full Name *</label>
        <input type="text" id="fullName" required>
        
        <label>Email</label>
        <input type="email" id="email">
        
        <label>Phone *</label>
        <input type="text" id="phone" required>
        
        <label>Message</label>
        <textarea id="message"></textarea>
        
        <label>Upload Resume (optional)</label>
        <input type="file" id="resume">
        
        <button type="submit">Submit Application</button>
      </form>
    </div>
  </div>

  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbw1BZnZ2fGTG9ES3riG15ni4bKLxL5B_LyyCzqZ2Ed6GVJEDwPytnwNRwCBHnxTeIT8/exec";

    async function loadJobs() {
      const res = await fetch(apiUrl);
      const data = await res.json();
      const jobs = data.jobs;

      const jobsDiv = document.getElementById("jobs");
      jobsDiv.innerHTML = jobs.map(job => `
        <div class="job-card">
          <h3>${job.Position}</h3>
          <p><strong>Country:</strong> ${job.Worker_Country}</p>
          <p><strong>Salary:</strong> SGD ${job.Monthly_Salary_SGD}</p>
          <p><strong>Gender:</strong> ${job.Gender}</p>
          <button onclick="openApply('${job.Job_ID}', '${job.Position}')">Apply</button>
        </div>
      `).join("");
    }

    function openApply(jobId, position) {
      document.getElementById("applyModal").style.display = "block";
      document.getElementById("jobId").value = jobId;
    }

    document.getElementById("closeModal").onclick = () => {
      document.getElementById("applyModal").style.display = "none";
    };

    document.getElementById("applyForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const formData = {
        Full_Name: document.getElementById("fullName").value,
        Email: document.getElementById("email").value,
        Phone: document.getElementById("phone").value,
        Enquiry_Type: "Job Application",
        Message: document.getElementById("message").value,
        ResumeUrl: "" // you can later extend with Drive upload
      };

      const res = await fetch(apiUrl, {
        method: "POST",
        body: JSON.stringify(formData)
      });

      const result = await res.json();
      alert(result.status === "success" ? "Application submitted!" : "Error, try again.");
      document.getElementById("applyModal").style.display = "none";
    });

    loadJobs();
  </script>
</body>
</html>
